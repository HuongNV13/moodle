{"version":3,"file":"duplicate.min.js","sources":["../src/duplicate.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handle question duplicating for question bank.\n *\n * @module qbank_duplicatequestion/duplicate\n * @copyright 2022 Huong Nguyen <huongnv13@gmail.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 4.1\n */\n\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {get_string as getString} from 'core/str';\nimport {displayException} from 'core/notification';\nimport Ajax from 'core/ajax';\n\nconst SELECTOR = {\n    duplicateQuestion: '.path-question [data-action=\"duplicatequestion\"]'\n};\n\n/**\n * Register events for duplicate links.\n */\nconst registerEventListeners = () => {\n    document.addEventListener('click', e => {\n        const duplicateAction = e.target.closest(SELECTOR.duplicateQuestion);\n        if (duplicateAction) {\n            e.preventDefault();\n            const modalPromise = Modal.create({\n                type: Modal.types.SAVE_CANCEL,\n                title: getString('confirmation', 'admin'),\n                body: 'Are you absolutely sure you want to duplicate this question?',\n                buttons: {\n                    save: getString('yes')\n                },\n            }).then(modal => {\n                modal.show();\n                return modal;\n            });\n            modalPromise.then(modal => {\n                modal.getRoot().on(ModalEvents.save, () => {\n                    const contextId = duplicateAction.dataset.contextid;\n                    const questionId = duplicateAction.dataset.questionid;\n                    const url = duplicateAction.dataset.url;\n                    const request = {\n                        methodname: 'qbank_duplicatequestion_make_duplicate',\n                        args: {\n                            questionid: questionId,\n                            contextid: contextId,\n                            returnurl: url,\n                        }\n                    };\n\n                    const response = Ajax.call([request])[0];\n                    response.then(data => {\n                        if (data.status) {\n                            window.location.assign(data.returnurl);\n                        }\n                        return;\n                    }).catch(displayException);\n                });\n                return modal;\n            }).catch(displayException);\n        }\n    });\n};\n\n/**\n * Initialises.\n */\nexport const init = () => {\n    window.console.log('Init');\n    registerEventListeners();\n};\n"],"names":["SELECTOR","window","console","log","document","addEventListener","e","duplicateAction","target","closest","preventDefault","Modal","create","type","types","SAVE_CANCEL","title","body","buttons","save","then","modal","show","getRoot","on","ModalEvents","contextId","dataset","contextid","request","methodname","args","questionid","returnurl","url","Ajax","call","data","status","location","assign","catch","displayException"],"mappings":";;;;;;;;kOA8BMA,2BACiB,iEAqDH,KAChBC,OAAOC,QAAQC,IAAI,QA/CnBC,SAASC,iBAAiB,SAASC,UACzBC,gBAAkBD,EAAEE,OAAOC,QAAQT,4BACrCO,kBACAD,EAAEI,iBACmBC,MAAMC,OAAO,CAC9BC,KAAMF,MAAMG,MAAMC,YAClBC,OAAO,mBAAU,eAAgB,SACjCC,KAAM,+DACNC,QAAS,CACLC,MAAM,mBAAU,UAErBC,MAAKC,QACJA,MAAMC,OACCD,SAEED,MAAKC,QACdA,MAAME,UAAUC,GAAGC,YAAYN,MAAM,WAC3BO,UAAYnB,gBAAgBoB,QAAQC,UAGpCC,QAAU,CACZC,WAAY,yCACZC,KAAM,CACFC,WALWzB,gBAAgBoB,QAAQK,WAMnCJ,UAAWF,UACXO,UANI1B,gBAAgBoB,QAAQO,MAUnBC,cAAKC,KAAK,CAACP,UAAU,GAC7BT,MAAKiB,OACNA,KAAKC,QACLrC,OAAOsC,SAASC,OAAOH,KAAKJ,cAGjCQ,MAAMC,mCAENrB,SACRoB,MAAMC"}