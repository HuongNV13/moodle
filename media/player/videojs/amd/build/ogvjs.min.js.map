{"version":3,"sources":["../src/ogvjs.js"],"names":["Tech","videojs","getComponent","OGVCompat","window","OGVLoader","OGVPlayer","defineLazyProperty","obj","key","getValue","setter","set","value","Object","defineProperty","enumerable","writable","options","configurable","get","OgvJS","ready","el_","src","source","setIfAvailable","autoplay","loop","poster","preload","on","console","log","ogvjsAudioChannels","ogvjsAudioSampleRate","triggerReady","removeEventListener","onFrameUpdate","options_","base","Error","el","className","tag","play","pause","paused","currentTime","seconds","e","duration","buffered","hasOwnProperty","volume","percentAsDecimal","muted","offsetWidth","offsetHeight","setSrc","load","currentSource_","currentSrc","val","el_controls","controls","error","seeking","seekable","ended","defaultMuted","playbackRate","played","networkState","readyState","videoWidth","videoHeight","name","isSupported","supported","canPlayType","type","indexOf","canPlaySource","srcObj","canControlVolume","p","canMuteVolume","canControlPlaybackRate","supportsNativeTextTracks","supportsFullscreenResize","supportsProgressEvents","supportsTimeupdateEvents","Events","forEach","fn","prototype","registerTech"],"mappings":"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","sourcesContent":["/**\n * ogv.js Tech plugin for Video.JS.\n *\n * @module     media_videojs/ogvjs\n * @copyright  2021 Huong Nguyen <huongnv13@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport videojs from 'media_videojs/video-lazy';\nconst Tech = videojs.getComponent('Tech');\n\n// Begin Moodle hack.\nconst OGVCompat = window.OGVCompat;\nconst OGVLoader = window.OGVLoader;\nconst OGVPlayer = window.OGVPlayer;\n// End Moodle hack.\n\nconst defineLazyProperty = function(obj, key, getValue, setter = true) {\n    const set = (value) =>\n        Object.defineProperty(obj, key, {value, enumerable: true, writable: true});\n\n    const options = {\n        configurable: true,\n        enumerable: true,\n        get() {\n            const value = getValue();\n\n            set(value);\n\n            return value;\n        }\n    };\n\n    if (setter) {\n        options.set = set;\n    }\n\n    return Object.defineProperty(obj, key, options);\n};\n\nclass OgvJS extends Tech {\n    constructor(options, ready) {\n        super(options, ready);\n\n        this.el_.src = options.source.src;\n        OgvJS.setIfAvailable(this.el_, 'autoplay', options.autoplay);\n        OgvJS.setIfAvailable(this.el_, 'loop', options.loop);\n        OgvJS.setIfAvailable(this.el_, 'poster', options.poster);\n        OgvJS.setIfAvailable(this.el_, 'preload', options.preload);\n\n        this.on('loadedmetadata', () => {\n            window.console.log('Loaded');\n            window.console.log(this.el_.ogvjsAudioChannels);\n            window.console.log(this.el_.ogvjsAudioSampleRate);\n            this.triggerReady();\n        });\n    }\n\n    dispose() {\n        this.el_.removeEventListener('framecallback', this.onFrameUpdate);\n        super.dispose();\n    }\n\n    createEl() {\n        let options = this.options_;\n\n        if (options.base) {\n            OGVLoader.base = options.base;\n        } else {\n            throw new Error('Please specify the base for the ogv.js library');\n        }\n\n        let el = new OGVPlayer(options);\n        el.className += ' vjs-tech';\n        options.tag = el;\n\n        return el;\n    }\n\n    play() {\n        this.el_.play();\n    }\n\n    pause() {\n        this.el_.pause();\n    }\n\n    paused() {\n        return this.el_.paused;\n    }\n\n    currentTime() {\n        return this.el_.currentTime;\n    }\n\n    setCurrentTime(seconds) {\n        try {\n            this.el_.currentTime = seconds;\n        } catch (e) {\n            videojs.log(e, 'Video is not ready. (Video.js)');\n        }\n    }\n\n    duration() {\n        if (this.el_.duration && this.el_.duration !== Infinity) {\n            return this.el_.duration;\n        }\n\n        return 0;\n    }\n\n    buffered() {\n        return this.el_.buffered;\n    }\n\n    volume() {\n        return this.el_.hasOwnProperty('volume') ? this.el_.volume : 1;\n    }\n\n    setVolume(percentAsDecimal) {\n        if (this.el_.hasOwnProperty('volume')) {\n            this.el_.volume = percentAsDecimal;\n        }\n    }\n\n    muted() {\n        return this.el_.muted;\n    }\n\n    setMuted(muted) {\n        this.el_.muted = !!muted;\n    }\n\n    width() {\n        return this.el_.offsetWidth;\n    }\n\n    height() {\n        return this.el_.offsetHeight;\n    }\n\n    src(src) {\n        if (typeof src === 'undefined') {\n            return this.el_.src;\n        }\n        this.setSrc(src);\n    }\n\n    setSrc(src) {\n        this.el_.src = src;\n    }\n\n    load() {\n        this.el_.load();\n    }\n\n    currentSrc() {\n        if (this.currentSource_) {\n            return this.currentSource_.src;\n        }\n        return this.el_.currentSrc;\n    }\n\n    poster() {\n        return this.el_.poster;\n    }\n\n    setPoster(val) {\n        this.el_.poster = val;\n    }\n\n    preload() {\n        return this.el_.preload || 'none';\n    }\n\n    setPreload(val) {\n        if (this.el_.hasOwnProperty('preload')) {\n            this.el_.preload = val;\n        }\n    }\n\n    autoplay() {\n        return this.el_.autoplay || false;\n    }\n\n    setAutoplay(val) {\n        if (this.el_.hasOwnProperty('autoplay')) {\n            this.el_.autoplay = !!val;\n            return;\n        }\n    }\n\n    controls() {\n        return this.el_controls || false;\n    }\n\n    setControls(val) {\n        if (this.el_.hasOwnProperty('controls')) {\n            this.el_.controls = !!val;\n        }\n    }\n\n    loop() {\n        return this.el_.loop || false;\n    }\n\n    setLoop(val) {\n        if (this.el_.hasOwnProperty('loop')) {\n            this.el_.loop = !!val;\n        }\n    }\n\n    error() {\n        return this.el_.error;\n    }\n\n    seeking() {\n        return this.el_.seeking;\n    }\n\n    seekable() {\n        return this.el_.seekable;\n    }\n\n    ended() {\n        return this.el_.ended;\n    }\n\n    defaultMuted() {\n        return this.el_.defaultMuted || false;\n    }\n\n    playbackRate() {\n        return this.el_.playbackRate || 1;\n    }\n\n    played() {\n        return this.el_.played;\n    }\n\n    setPlaybackRate(val) {\n        if (this.el_.hasOwnProperty('playbackRate')) {\n            this.el_.playbackRate = val;\n        }\n    }\n\n    networkState() {\n        return this.el_.networkState;\n    }\n\n    readyState() {\n        return this.el_.readyState;\n    }\n\n    videoWidth() {\n        return this.el_.videoWidth;\n    }\n\n    videoHeight() {\n        return this.el_.videoHeight;\n    }\n\n    supportsFullScreen() {\n        return false;\n    }\n}\n\nOgvJS.setIfAvailable = function(el, name, value) {\n    if (el.hasOwnProperty(name)) {\n        el[name] = value;\n    }\n};\n\nOgvJS.isSupported = function() {\n    return OGVCompat.supported('OGVPlayer');\n};\n\nOgvJS.canPlayType = function(type) {\n    return (type.indexOf('/ogg') !== -1 || type.indexOf('/webm')) ? 'maybe' : '';\n};\n\nOgvJS.canPlaySource = function(srcObj) {\n    return OgvJS.canPlayType(srcObj.type);\n};\n\nOgvJS.canControlVolume = function() {\n    let p = new OGVPlayer();\n\n    return p.hasOwnProperty('volume');\n};\n\nOgvJS.canMuteVolume = function() {\n    return true;\n};\n\nOgvJS.canControlPlaybackRate = function() {\n    return true;\n};\n\nOgvJS.supportsNativeTextTracks = function() {\n    return false;\n};\n\nOgvJS.supportsFullscreenResize = function() {\n    return true;\n};\n\nOgvJS.supportsProgressEvents = function() {\n    return true;\n};\n\nOgvJS.supportsTimeupdateEvents = function() {\n    return true;\n};\n\nOgvJS.Events = [\n    'loadstart',\n    'suspend',\n    'abort',\n    'error',\n    'emptied',\n    'stalled',\n    'loadedmetadata',\n    'loadeddata',\n    'canplay',\n    'canplaythrough',\n    'playing',\n    'waiting',\n    'seeking',\n    'seeked',\n    'ended',\n    'durationchange',\n    'timeupdate',\n    'progress',\n    'play',\n    'pause',\n    'ratechange',\n    'resize',\n    'volumechange'\n];\n\n[\n    ['featuresVolumeControl', 'canControlVolume'],\n    ['featuresMuteControl', 'canMuteVolume'],\n    ['featuresPlaybackRate', 'canControlPlaybackRate'],\n    ['featuresNativeTextTracks', 'supportsNativeTextTracks'],\n    ['featuresFullscreenResize', 'supportsFullscreenResize'],\n    ['featuresProgressEvents', 'supportsProgressEvents'],\n    ['featuresTimeupdateEvents', 'supportsTimeupdateEvents'],\n].forEach(function([key, fn]) {\n    defineLazyProperty(OgvJS.prototype, key, () => OgvJS[fn](), true);\n});\n\nTech.registerTech('OgvJS', OgvJS);\nexport default OgvJS;\n"],"file":"ogvjs.min.js"}