define("tiny_aiplacement/ui",["exports","core/modal_events","tiny_aiplacement/modal","tiny_aiplacement/options","core/ajax","tiny_aiplacement/loading"],(function(_exports,_modal_events,_modal,_options,_ajax,_loading){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny AI UI.
   *
   * @module      tiny_aiplacement/ui
   * @copyright   2024 Matt Porritt <matt.porritt@moodle.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.displayModal=void 0,_modal_events=_interopRequireDefault(_modal_events),_modal=_interopRequireDefault(_modal),_ajax=_interopRequireDefault(_ajax);let responseObj=null;_exports.displayModal=async editor=>{const modalObject=await _modal.default.create({type:_modal.default.TYPE,templateContext:getTemplateContext(editor),xlarge:!0}),modalroot=await modalObject.getRoot(),root=modalroot[0];modalObject.show(),modalroot.on(_modal_events.default.hidden,(()=>{modalObject.destroy()})),root.addEventListener("click",(e=>{const submitBtn=e.target.closest('[data-action="generate"]'),insertBtn=e.target.closest('[data-action="inserter"]'),cancelBtn=e.target.closest('[data-action="cancel"]');submitBtn?(e.preventDefault(),handleSubmit(editor,root,submitBtn)):insertBtn?(e.preventDefault(),handleInsert(editor,root),modalObject.destroy()):cancelBtn&&modalObject.destroy()}));const generateBtn=root.querySelector("#"+editor.id+"_tiny_aiplacement_generatebutton"),promptArea=root.querySelector("#"+editor.id+"_tiny_aiplacement_prompttext");promptArea.addEventListener("input",(()=>{generateBtn.disabled=""===promptArea.value.trim()}))};const getTemplateContext=editor=>({elementid:editor.id,modaltitle:"Generate AI Content"}),handleSubmit=async(editor,root,submitBtn)=>{displayLoading(editor.id,root,submitBtn);const request={methodname:"tiny_aiplacement_generate_content",args:{contextid:(0,_options.getContextId)(editor),prompttext:root.querySelector("#"+editor.id+"_tiny_aiplacement_prompttext").value,aspectratio:"square",quality:"hd",style:"natural"}};try{responseObj=await _ajax.default.call([request])[0],window.console.log(responseObj);const generatedResponseEl=root.querySelector("#"+editor.id+"_tiny_aiplacement_responsetext"),insertBtn=root.querySelector('[data-action="inserter"]');generatedResponseEl.value=responseObj.generatedcontent,generatedResponseEl.disabled=!1,hideLoading(editor.id,root,submitBtn),insertBtn.classList.remove("hidden")}catch(error){window.console.log(error)}},displayLoading=(editorId,root,submitBtn)=>{const loadingSpinnerDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_spinner"),overlayDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_overlay"),blurDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_blur"),loadingTextDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_loading_text");(0,_loading.loadingMessages)(loadingTextDiv),loadingSpinnerDiv.classList.remove("hidden"),overlayDiv.classList.remove("hidden"),blurDiv.classList.add("tiny-ai-blur"),submitBtn.innerHTML="Generating...",submitBtn.disabled=!0},hideLoading=(editorId,root,submitBtn)=>{const loadingSpinnerDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_spinner"),overlayDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_overlay"),blurDiv=root.querySelector("#"+editorId+"_tiny_aiplacement_blur");loadingSpinnerDiv.classList.add("hidden"),overlayDiv.classList.add("hidden"),blurDiv.classList.remove("tiny-ai-blur"),submitBtn.innerHTML="Regenerate",submitBtn.disabled=!1},handleInsert=async(editor,root)=>{window.console.log(editor),window.console.log(root)}}));

//# sourceMappingURL=ui.min.js.map