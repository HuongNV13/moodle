{"version":3,"sources":["../src/popover.js"],"names":["blockNode","initPopover","dates","forEach","date","dateEle","popover","trigger","placement","html","content","source","next","length","temptContent","find","clone","enablePopover","disablePopover","isPopoverAvailable","isAvailable","dayContents","querySelectorAll","dayContent","window","getComputedStyle","display","handlePopover","init","instanceId","document","querySelector","addEventListener","eventTypes","blockMoved","e","detail"],"mappings":"6LAyBA,OACA,O,sDAGIA,CAAAA,CAAS,CAAG,I,CAMVC,CAAW,CAAG,SAACC,CAAD,CAAW,CAC3BA,CAAK,CAACC,OAAN,CAAc,SAACC,CAAD,CAAU,CACpB,GAAIC,CAAAA,CAAO,CAAG,cAAOD,CAAP,CAAd,CACAC,CAAO,CAACC,OAAR,CAAgB,CACZC,OAAO,CAAE,aADG,CAEZC,SAAS,CAAE,KAFC,CAGZC,IAAI,GAHQ,CAIZC,OAAO,CAAE,UAAW,IACZC,CAAAA,CAAM,CAAGN,CAAO,CAACO,IAAR,CAAa,kCAAb,CADG,CAEZF,CAAO,CAAG,cAAO,OAAP,CAFE,CAGhB,GAAIC,CAAM,CAACE,MAAX,CAAmB,CACf,GAAIC,CAAAA,CAAY,CAAGH,CAAM,CAACI,IAAP,CAAY,SAAZ,EAAuBC,KAAvB,IAAnB,CACAN,CAAO,CAACD,IAAR,CAAaK,CAAY,CAACL,IAAb,EAAb,CACH,CACD,MAAOC,CAAAA,CAAO,CAACD,IAAR,EACV,CAZW,CAAhB,CAcH,CAhBD,CAiBH,C,CAMKQ,CAAa,CAAG,SAACf,CAAD,CAAW,CAC7BA,CAAK,CAACC,OAAN,CAAc,SAACC,CAAD,CAAU,CACpB,GAAIC,CAAAA,CAAO,CAAG,cAAOD,CAAP,CAAd,CACAC,CAAO,CAACC,OAAR,CAAgB,QAAhB,CACH,CAHD,CAIH,C,CAMKY,CAAc,CAAG,SAAChB,CAAD,CAAW,CAC9BA,CAAK,CAACC,OAAN,CAAc,SAACC,CAAD,CAAU,CACpB,GAAIC,CAAAA,CAAO,CAAG,cAAOD,CAAP,CAAd,CACAC,CAAO,CAACC,OAAR,CAAgB,SAAhB,CACH,CAHD,CAIH,C,CAOKa,CAAkB,CAAG,UAAM,IACzBC,CAAAA,CAAW,GADc,CAEzBC,CAAW,CAAGrB,CAAS,CAACsB,gBAAV,CAA2B,2CAA3B,CAFW,CAG7BD,CAAW,CAAClB,OAAZ,CAAoB,SAACoB,CAAD,CAAgB,CAChC,GAAoD,MAAhD,GAAAC,MAAM,CAACC,gBAAP,CAAwBF,CAAxB,EAAoCG,OAAxC,CAA4D,CACxDN,CAAW,GACd,CACJ,CAJD,EAKA,MAAOA,CAAAA,CACV,C,CAMKO,CAAa,CAAG,SAACzB,CAAD,CAAW,CAC7B,GAAIiB,CAAkB,EAAtB,CAA0B,CACtBF,CAAa,CAACf,CAAD,CAChB,CAFD,IAEO,CACHgB,CAAc,CAAChB,CAAD,CACjB,CACJ,C,CASY0B,CAAI,CAAG,SAACC,CAAD,CAAgB,CAChC7B,CAAS,CAAG8B,QAAQ,CAACC,aAAT,CAAuB,uBAAwBF,CAAxB,CAAqC,KAA5D,CAAZ,CACA,GAAM3B,CAAAA,CAAK,CAAGF,CAAS,CAACsB,gBAAV,CAA2B,6CAA3B,CAAd,CACArB,CAAW,CAACC,CAAD,CAAX,CACA,GAAI,CAACiB,CAAkB,EAAvB,CAA2B,CACvBD,CAAc,CAAChB,CAAD,CACjB,CAED4B,QAAQ,CAACE,gBAAT,CAA0BC,aAAWC,UAArC,CAAiD,SAASC,CAAT,CAAY,CACzD,GAAIA,CAAC,CAACC,MAAF,CAASP,UAAT,GAAwBA,CAA5B,CAAwC,CACpCF,CAAa,CAACzB,CAAD,CAChB,CACJ,CAJD,EAMAsB,MAAM,CAACQ,gBAAP,CAAwB,QAAxB,CAAkC,UAAW,CACzCL,CAAa,CAACzB,CAAD,CAChB,CAFD,CAGH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript popover for the `core_calendar` subsystem.\n *\n * @module core_calendar/popover\n * @copyright 2021 Huong Nguyen <huongnv13@gmail.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 4.0\n */\n\n// eslint-disable-next-line no-unused-vars\nimport Popover from 'theme_boost/popover';\nimport jQuery from 'jquery';\nimport {eventTypes} from 'core_block/events';\n\nlet blockNode = null;\n\n/**\n * Init the popover init for calendar date.\n * @param {NodeList} dates List of date element to enable\n */\nconst initPopover = (dates) => {\n    dates.forEach((date) => {\n        let dateEle = jQuery(date);\n        dateEle.popover({\n            trigger: 'hover focus',\n            placement: 'top',\n            html: true,\n            content: function() {\n                let source = dateEle.next('div[data-region=\"day-content\"]');\n                let content = jQuery('<div>');\n                if (source.length) {\n                    let temptContent = source.find('.hidden').clone(false);\n                    content.html(temptContent.html());\n                }\n                return content.html();\n            }\n        });\n    });\n};\n\n/**\n * Enable the popover for calendar date.\n * @param {NodeList} dates List of date element to enable\n */\nconst enablePopover = (dates) => {\n    dates.forEach((date) => {\n        let dateEle = jQuery(date);\n        dateEle.popover('enable');\n    });\n};\n\n/**\n * Disable the popover for calendar date.\n * @param {NodeList} dates List of date element to enable\n */\nconst disablePopover = (dates) => {\n    dates.forEach((date) => {\n        let dateEle = jQuery(date);\n        dateEle.popover('disable');\n    });\n};\n\n/**\n * Check if we are allowing to enable the popover or not.\n *\n * @returns {boolean}\n */\nconst isPopoverAvailable = () => {\n    let isAvailable = false;\n    let dayContents = blockNode.querySelectorAll('.d-md-block [data-region=\"day-content\"]');\n    dayContents.forEach((dayContent) => {\n        if (window.getComputedStyle(dayContent).display === 'none') {\n            isAvailable = true;\n        }\n    });\n    return isAvailable;\n};\n\n/**\n * Popover event handler\n * @param {NodeList} dates List of date element\n */\nconst handlePopover = (dates) => {\n    if (isPopoverAvailable()) {\n        enablePopover(dates);\n    } else {\n        disablePopover(dates);\n    }\n};\n\n/**\n * Initialises popover.\n *\n * @param {String} instanceId Form element\n * @listens event:blockMoved\n * @listens event:resize\n */\nexport const init = (instanceId) => {\n    blockNode = document.querySelector('[data-instance-id=\"' + instanceId + '\"]');\n    const dates = blockNode.querySelectorAll('.d-md-block [data-action=\"view-day-link\"]');\n    initPopover(dates);\n    if (!isPopoverAvailable()) {\n        disablePopover(dates);\n    }\n\n    document.addEventListener(eventTypes.blockMoved, function(e) {\n        if (e.detail.instanceId === instanceId) {\n            handlePopover(dates);\n        }\n    });\n\n    window.addEventListener('resize', function() {\n        handlePopover(dates);\n    });\n};"],"file":"popover.min.js"}