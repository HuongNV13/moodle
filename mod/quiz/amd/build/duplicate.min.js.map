{"version":3,"file":"duplicate.min.js","sources":["../src/duplicate.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {get_string as getString} from 'core/str';\nimport {displayException} from 'core/notification';\nimport Ajax from 'core/ajax';\n\n/**\n * A javascript module to handle question duplicating for quiz.\n *\n * @module mod_quiz/duplicate\n * @copyright 2022 Huong Nguyen <huongnv13@gmail.com>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 4.1\n */\n\nconst SELECTOR = {\n    duplicateQuestion: '.path-mod-quiz [data-action=\"duplicatequestion\"]'\n};\n\n/**\n * Register events for duplicate links.\n * @param {int} contextId\n * @param {string} returnUrl\n * @param {int} cmId\n * @param {int} quizId\n */\n// eslint-disable-next-line no-unused-vars\nconst registerEventListeners = (contextId, returnUrl, cmId, quizId) => {\n    document.addEventListener('click', e => {\n        const duplicateAction = e.target.closest(SELECTOR.duplicateQuestion);\n        if (duplicateAction) {\n            e.preventDefault();\n            const modalPromise = Modal.create({\n                type: Modal.types.SAVE_CANCEL,\n                title: getString('confirmation', 'admin'),\n                body: 'Are you absolutely sure you want to duplicate this question?',\n                buttons: {\n                    save: getString('yes')\n                },\n            }).then(modal => {\n                modal.show();\n                return modal;\n            });\n            modalPromise.then(modal => {\n                modal.getRoot().on(ModalEvents.save, () => {\n                    const questionId = duplicateAction.dataset.questionid;\n                    const request = {\n                        methodname: 'qbank_duplicatequestion_make_duplicate',\n                        args: {\n                            questionid: questionId,\n                            contextid: contextId,\n                            returnurl: returnUrl,\n                        }\n                    };\n\n                    const response = Ajax.call([request])[0];\n                    response.then(data => {\n                        if (data.status) {\n                            const createdQuestionId = data.createdquestionid;\n                            const pageNumber = duplicateAction.dataset.page;\n                            const request = {\n                                methodname: 'mod_quiz_add_question_to_quiz',\n                                args: {\n                                    questionid: createdQuestionId,\n                                    quizid: quizId,\n                                    page: pageNumber,\n                                }\n                            };\n                            const response = Ajax.call([request])[0];\n                            response.then(data => {\n                                window.console.log(data);\n                                window.location.assign(returnUrl);\n                                return;\n                            }).catch(displayException);\n                        }\n                        return;\n                    }).catch(displayException);\n                });\n                return modal;\n            }).catch(displayException);\n        }\n    });\n};\n\n/**\n * Initialises.\n * @param {int} contextId\n * @param {string} returnUrl\n * @param {int} cmId\n * @param {int} quizId\n */\nexport const init = (contextId, returnUrl, cmId, quizId) => {\n    registerEventListeners(contextId, returnUrl, cmId, quizId);\n};\n"],"names":["SELECTOR","contextId","returnUrl","cmId","quizId","document","addEventListener","e","duplicateAction","target","closest","preventDefault","Modal","create","type","types","SAVE_CANCEL","title","body","buttons","save","then","modal","show","getRoot","on","ModalEvents","request","methodname","args","questionid","dataset","contextid","returnurl","Ajax","call","data","status","createdQuestionId","createdquestionid","pageNumber","page","quizid","window","console","log","location","assign","catch","displayException","registerEventListeners"],"mappings":";;;;;;;;kOA8BMA,2BACiB,iEA2EH,CAACC,UAAWC,UAAWC,KAAMC,UAhElB,EAACH,UAAWC,UAAWC,KAAMC,UACxDC,SAASC,iBAAiB,SAASC,UACzBC,gBAAkBD,EAAEE,OAAOC,QAAQV,4BACrCQ,kBACAD,EAAEI,iBACmBC,MAAMC,OAAO,CAC9BC,KAAMF,MAAMG,MAAMC,YAClBC,OAAO,mBAAU,eAAgB,SACjCC,KAAM,+DACNC,QAAS,CACLC,MAAM,mBAAU,UAErBC,MAAKC,QACJA,MAAMC,OACCD,SAEED,MAAKC,QACdA,MAAME,UAAUC,GAAGC,YAAYN,MAAM,WAE3BO,QAAU,CACZC,WAAY,yCACZC,KAAM,CACFC,WAJWtB,gBAAgBuB,QAAQD,WAKnCE,UAAW/B,UACXgC,UAAW/B,YAIFgC,cAAKC,KAAK,CAACR,UAAU,GAC7BN,MAAKe,UACNA,KAAKC,OAAQ,OACPC,kBAAoBF,KAAKG,kBACzBC,WAAahC,gBAAgBuB,QAAQU,KACrCd,QAAU,CACZC,WAAY,gCACZC,KAAM,CACFC,WAAYQ,kBACZI,OAAQtC,OACRqC,KAAMD,aAGGN,cAAKC,KAAK,CAACR,UAAU,GAC7BN,MAAKe,OACVO,OAAOC,QAAQC,IAAIT,MACnBO,OAAOG,SAASC,OAAO7C,cAExB8C,MAAMC,oCAGdD,MAAMC,mCAEN3B,SACR0B,MAAMC,qCAajBC,CAAuBjD,UAAWC,UAAWC,EAAMC"}