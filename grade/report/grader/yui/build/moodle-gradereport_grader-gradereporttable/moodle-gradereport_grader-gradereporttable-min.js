YUI.add("moodle-gradereport_grader-gradereporttable",function(e,t){function i(){i.superclass.constructor.apply(this,arguments)}function c(){}var n={FOOTERTITLE:".avg .header",FOOTERCELLS:"#user-grades .avg .cell",FOOTERROW:"#user-grades .avg",GRADECELL:"td.grade",GRADERTABLE:".gradeparent table",GRADEPARENT:".gradeparent",HEADERCELLS:"#user-grades .heading .cell",HEADERCELL:".gradebook-header-cell",HEADERROW:"#user-grades tr.heading",STUDENTHEADER:"#studentheader",USERCELL:"#user-grades .user.cell",USERMAIL:"#user-grades .useremail"},r={OVERRIDDEN:"overridden",TOOLTIPACTIVE:"tooltipactive"};e.extend(i,e.Base,{_eventHandles:[],graderTable:null,initializer:function(){this.graderRegion=e.one(n.GRADEPARENT),this.graderTable=e.one(n.GRADERTABLE),this.setupFloatingHeaders()},getGradeUserName:function(e){var t=e.ancestor("tr"),n=t.one("th.user .username");return n?n.get("text"):""},getGradeItemName:function(t){var n=e.one("th.item[data-itemid='"+t.getData("itemid")+"']");return n?n.get("text"):""},getGradeFeedback:function(e){return e.getData("feedback")}}),e.namespace("M.gradereport_grader").ReportTable=i,e.namespace("M.gradereport_grader").init=function(t){return new e.M.gradereport_grader.ReportTable(t)};var s="height",o="width",u="offsetWidth",a="offsetHeight",f="moodle-core-grade-report-grader",l=1;r.FLOATING="floating",c.ATTRS={},c.prototype={pageHeaderHeight:0,container:null,headerCell:null,headerRow:null,firstUserCell:null,firstNonUserCell:null,firstNonUserCellLeft:0,firstNonUserCellWidth:0,tableFooterRow:null,footerRow:null,gradeItemHeadingContainer:null,userColumnHeader:null,userColumn:null,firstUserCellBottom:0,firstUserCellLeft:0,firstUserCellWidth:0,dockWidth:0,lastUserCellTop:0,floatingHeaderRow:null,_eventHandles:[],lastBodyMargin:0,setupFloatingHeaders:function(){this.firstUserCell=e.one(n.USERCELL),this.container=e.one(n.GRADEPARENT),this.firstNonUserCell=e.one(n.GRADECELL);if(!this.firstUserCell)return this;if(M.cfg.behatsiterunning)return;return this._setupFloatingUserColumn(),this._setupFloatingUserHeader(),this._setupFloatingAssignmentHeaders(),this._setupFloatingAssignmentFooter(),this.floatingHeaderRow={},this._setupFloatingLeftHeaders(".controls .controls"),this._setupFloatingLeftHeaders(".range .range"),this._setupFloatingLeftHeaders(n.FOOTERTITLE),this._setupFloatingAssignmentFooterTitle(),this._calculateCellPositions(),this._handleScrollEvent(),this._setupEventHandlers(),e.Global.on("moodle-gradereport_grader:resized",this._handleResizeEvent,this),this},_calculateCellPositions:function(){this.headerRowTop=this.headerRow.getY(),this.tableFooterRow&&(this.footerRowPosition=this.tableFooterRow.getY()),this.dockWidth=0;var t=e.one(".has_dock #dock");t&&(this.dockWidth=t.get(u));var r=e.all(n.USERCELL);this.firstUserCellLeft=this.firstUserCell.getX(),this.firstUserCellWidth=this.firstUserCell.get(u),this.firstNonUserCellLeft=this.firstNonUserCell.getX(),this.firstNonUserCellWidth=this.firstNonUserCell.get(u);if(r.size()>1){var i=r.item(1);this.firstUserCellBottom=i.getY()+parseInt(i.getComputedStyle(s),10),this.lastUserCellTop=r.item(r.size()-2).getY()}else{var o=r.item(0);this.lastUserCellTop=o.getY(),this.tableFooterRow?this.firstUserCellBottom=this.footerRowPosition+parseInt(this.tableFooterRow.getComputedStyle(s),10):this.firstUserCellBottom=o.getY()+o.get("offsetHeight")}var f=e.one("header");this.pageHeaderHeight=0;if(f)if(f.getComputedStyle("position")==="fixed")this.pageHeaderHeight=f.get(a);else{var l=e.one(".navbar");l&&l.getComputedStyle("position")==="fixed"&&(this.pageHeaderHeight=l.get(a))}},_getRelativeXY:function(e){return this._getRelativeXYFromXY(e.getX(),e.getY())},_getRelativeXYFromXY:function(e,t){var n=this.graderTable.getXY();return[e-n[0],t-n[1]]},_getRelativeXFromX:function(e){return this._getRelativeXYFromXY(e,0)[0]},_getRelativeYFromY:function(e){return this._getRelativeXYFromXY(0,e)[1]},_getScrollBarHeight:function(){return e.UA.ie&&e.UA.ie>=10?0:e.config.doc.body.scrollWidth>e.config.doc.body.clientWidth?e.DOM.getScrollbarWidth():0},_setupEventHandlers:function(){this._eventHandles.push(e.one(n.GRADEPARENT).on("scroll",this._handleScrollEvent,this),e.one(e.config.win).on("resize",this._handleResizeEvent,this),e.one(e.config.win).on("orientationchange",this._handleResizeEvent,this),e.Global.on("dock:shown",this._handleResizeEvent,this),e.Global.on("dock:hidden",this._handleResizeEvent,this))},_setupFloatingUserColumn:function(){var t=e.all(n.USERCELL),r=e.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),i=this._getRelativeXY(this.firstUserCell);t.each(function(t){var n=t.getComputedStyle(s);e.UA.ie!==0&&(n=t.get("offsetHeight"));var i=e.Node.create("<div></div>");i.set("innerHTML",t.get("innerHTML")).setAttribute("class",t.getAttribute("class")).setAttribute("data-uid",t.ancestor("tr").getData("uid")).setStyles({height:n,width:t.getComputedStyle(o)}),r.appendChild(i)},this),r.setStyles({left:i[0]+"px",position:"absolute",top:i[1]+"px"}),this.graderRegion.append(r),this.userColumn=r},_setupFloatingUserHeader:function(){this.headerRow=e.one(n.HEADERROW),this.headerCell=e.one(n.STUDENTHEADER);var t=e.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly heading"></div>'),r=e.Node.create("<div></div>"),i=this._getRelativeXY(this.headerCell)[0],s=this._getRelativeXY(this.headerRow),a=s[0],f=this.firstUserCell.getComputedStyle(o);e.UA.ie!==0&&(f=this.firstUserCell.get(u)+"px"),r.set("innerHTML",this.headerCell.getHTML()).setAttribute("class",this.headerCell.getAttribute("class")).setStyles({width:f,left:i-a+"px"}),t.setStyles({left:s[0]+"px",position:"absolute",top:s[1]+"px"}),t.append(r),this.graderRegion.append(t),this.userColumnHeader=t},_setupFloatingAssignmentHeaders:function(){this.headerRow=e.one("#user-grades tr.heading");var t=e.all("#user-grades tr.heading .cell"),n=e.Node.create('<div aria-hidden="true" role="presentation" class="floater heading"></div>'),r=this._getRelativeXY
(this.headerRow),i=0,f=0,l=r[0];t.each(function(t){var r=this._getRelativeXY(t)[0],c=e.Node.create("<div></div>"),h=t.getComputedStyle(o),p=t.getComputedStyle(s);e.UA.ie!==0&&(h=t.get(u)+"px",p=t.get(a)+"px"),c.append(t.getHTML()).setAttribute("class",t.getAttribute("class")).setData("itemid",t.getData("itemid")).setStyles({height:p,left:r-l+"px",position:"absolute",width:h}),i+=parseInt(t.get(u),10),f=t.get(a),n.appendChild(c)},this),n.setStyles({height:f+"px",left:r[0]+"px",position:"absolute",top:r[1]+"px",width:i+"px"}),this.userColumnHeader.insert(n,"before"),this.gradeItemHeadingContainer=n},_setupFloatingAssignmentFooter:function(){this.tableFooterRow=e.one("#user-grades .avg");if(!this.tableFooterRow)return;var t=this.tableFooterRow.all(".cell"),n=e.Node.create('<div aria-hidden="true" role="presentation" class="floater avg"></div>'),r=0,i=this._getRelativeXY(this.tableFooterRow),f=i[0],l=0;t.each(function(t){var i=e.Node.create("<div></div>"),c=this._getRelativeXY(t)[0],h=t.getComputedStyle(o),p=t.getComputedStyle(s);e.UA.ie!==0&&(h=t.get(u)+"px",p=t.get(a)+"px"),i.set("innerHTML",t.getHTML()).setAttribute("class",t.getAttribute("class")).setStyles({height:p,left:c-f+"px",position:"absolute",width:h}),n.append(i),l=t.get(a),r+=parseInt(t.get(u),10)},this),n.setStyles({position:"absolute",left:i[0]+"px",bottom:"1px",height:l+"px",width:r+"px"}),this.graderRegion.append(n),this.footerRow=n},_setupFloatingAssignmentFooterTitle:function(){var e=this.floatingHeaderRow[n.FOOTERTITLE];e&&e.setStyles({bottom:"1px"})},_setupFloatingLeftHeaders:function(t){var n=e.one(t);if(!n)return;var r=e.Node.create('<div aria-hidden="true" role="presentation" class="floater sideonly"></div>'),i=e.Node.create("<div></div>"),f=this._getRelativeXY(n),l=this.firstUserCell.getComputedStyle(o),c=n.getComputedStyle(s);e.UA.ie!==0&&(l=this.firstUserCell.get(u)+"px",c=n.get(a)+"px"),i.set("innerHTML",n.getHTML()).setAttribute("class",n.getAttribute("class")).setStyles({width:l,height:c}),r.setStyles({position:"absolute",top:f[1]+"px",left:f[0]+"px",height:c+"px"}).addClass(n.get("parentNode").get("className")),r.append(i),this.graderRegion.append(r),this.floatingHeaderRow[t]=r},_handleScrollEvent:function(){var t={},i={},s={},o={},a=0,f=0,c=!1,h=!1,p=!1,d=!1,v={},m={},g=!1,y=0,b=this._getRelativeYFromY(this.container.getY()),w=this.container.get("clientWidth"),E=this.graderTable.get("clientWidth"),S=this.container.get(u)-this.container.get("clientWidth"),x=e.one(n.FOOTERTITLE).get("clientWidth"),T=e.one("#user-grades tr:first-child");window.right_to_left()?y=parseInt(e.one(e.config.doc.body).getComputedStyle("marginRight"),10):y=parseInt(e.one(e.config.doc.body).getComputedStyle("marginLeft"),10),y!=this.lastBodyMargin&&this._calculateCellPositions(),window.right_to_left()?t.left=w-E-l+"px":t.left=l+"px",b>this._getRelativeYFromY(this.headerRow.getY())?(c=!0,a=b,t.top=a+"px",i.top=a+"px"):(c=!1,a=this._getRelativeYFromY(this.headerRowTop),t.top=a+"px",e.UA.ie!==0?i.top=this.headerCell.get("offsetTop")-T.get("offsetTop"):i.top=T.getComputedStyle("height"));if(window.right_to_left()){var N=w+S-this.firstUserCellWidth-l,C=E-this._getRelativeXFromX(this.container.getX()+w);f=N-C,h=this._getRelativeXFromX(this.container.getX())+this.container.get(u)<E,d=this._getRelativeXFromX(this.container.getX())+this.container.get(u)<E+this.firstUserCellWidth-x}else f=this._getRelativeXFromX(this.container.getX()),h=f>0,d=x-this._getRelativeXFromX(this.container.getX())<this.firstUserCellWidth;h?(a=f,s.left=a+"px",i.left=a+"px"):(a=this._getRelativeXFromX(this.firstUserCellLeft),s.left=a+"px",i.left=a+"px"),e.Object.each(this.floatingHeaderRow,function(e,t){v[t]={left:s.left}},this);if(this.footerRow){window.right_to_left()?o.left=w-E-l+"px":o.left=l+"px";var k=this._getRelativeYFromY(this.container.getY())+this.container.get("clientHeight"),L=parseInt(this.graderTable.getComputedStyle("height"));e.UA.ie!==0&&(L=this.graderTable.get("clientHeight")),m=v[n.FOOTERTITLE],g=this.floatingHeaderRow[n.FOOTERTITLE],L>k?(o.bottom=Math.floor(-1*b)+"px",p=!0):(o.bottom=this.container.get("clientHeight")-L+"px",p=!1),m&&(m.bottom=o.bottom,m.top=null),v[n.FOOTERTITLE]=m}this.gradeItemHeadingContainer&&(this.gradeItemHeadingContainer.setStyles(t),c?this.gradeItemHeadingContainer.addClass(r.FLOATING):this.gradeItemHeadingContainer.removeClass(r.FLOATING)),this.userColumnHeader&&(this.userColumnHeader.setStyles(i),h?this.userColumnHeader.addClass(r.FLOATING):this.userColumnHeader.removeClass(r.FLOATING)),this.userColumn&&(this.userColumn.setStyles(s),h?this.userColumn.addClass(r.FLOATING):this.userColumn.removeClass(r.FLOATING)),this.footerRow&&(this.footerRow.setStyles(o),p?this.footerRow.addClass(r.FLOATING):this.footerRow.removeClass(r.FLOATING)),e.Object.each(v,function(e,t){this.floatingHeaderRow[t]&&this.floatingHeaderRow[t].setStyles(e)},this),e.Object.each(this.floatingHeaderRow,function(e,t){this.floatingHeaderRow[t]&&(d?this.floatingHeaderRow[t].addClass(r.FLOATING):this.floatingHeaderRow[t].removeClass(r.FLOATING))},this),g&&(d?g.addClass(r.FLOATING):g.removeClass(r.FLOATING))},_handleResizeEvent:function(){this._calculateCellPositions(),this._handleScrollEvent();var t=this.firstUserCell.getComputedStyle(o),r=e.all(n.USERCELL);e.UA.ie!==0&&(t=this.firstUserCell.get(u)+"px"),this.userColumnHeader.one(".cell").setStyle("width",t),this.userColumn.all(".cell").each(function(n,i){var o=r.item(i).getComputedStyle(s);if(e.UA.ie!==0){var u=r.item(i);o=u.getDOMNode?u.getDOMNode().getBoundingClientRect().height:u.get("offsetHeight")}n.setStyles({width:t,height:o})},this);var i=this.gradeItemHeadingContainer.all(".cell"),a=e.all(n.HEADERCELLS),f=this.headerRow.getX(),l=0;a.each(function(t,n){var r=i.item(n),s=t.getComputedStyle(o);e.UA.ie!==0&&(s=t.get(u)),l+=t.get(u);var a={width:s,left:t.getX()-f+"px"};r.setStyles(a)});if(this.footerRow){var c=this.footerRow.all(".cell");if(c.size()!==0){var h=e.all(n.FOOTERCELLS);h.each(function(t,n){var r=
c.item(n),i=t.getComputedStyle(o);e.UA.ie!==0&&(i=t.get(u));var s={width:i,left:t.getX()-f+"px"};r.setStyles(s)})}}e.Object.each(this.floatingHeaderRow,function(e){e.one("div").setStyle("width",t)},this),this.gradeItemHeadingContainer.setStyle("width",l)}},e.Base.mix(e.M.gradereport_grader.ReportTable,[c])},"@VERSION@",{requires:["base","node","event","handlebars","overlay","event-hover"]});
