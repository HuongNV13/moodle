{"version":3,"file":"share.min.js","sources":["../src/share.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A module to handle Share operations of the MoodleNet.\n *\n * @module     tool_moodlenet/share\n * @copyright  2022 Huong Nguyen <huongnv13@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      4.1\n */\n\nimport Config from 'core/config';\nimport {displayException, addNotification} from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport Prefetch from 'core/prefetch';\nimport * as Templates from 'core/templates';\nimport ShareModalActivity from \"tool_moodlenet/share_modal_activity\";\nimport * as MoodleNetSelectors from 'tool_moodlenet/selectors';\nimport * as MoodleNetRepository from 'tool_moodlenet/repository';\n\nlet currentModal;\nlet siteSupportUrl;\n\n/**\n * Handle send to MoodleNet\n * @param {boolean} status\n */\nconst sendToMoodleNet = (status) => {\n    const $modal = currentModal.getModal();\n    const modal = $modal[0];\n    modal.querySelector('.modal-header').classList.remove('no-border');\n\n    currentModal.setBody(Templates.render('tool_moodlenet/share_modal_content_packaging', {}));\n    currentModal.hideFooter();\n\n    setTimeout(() => {\n        moodleNetDone(status);\n    }, 5000);\n};\n\n/**\n * Handle done status.\n * @param {boolean} status\n */\nconst moodleNetDone = (status) => {\n    const $modal = currentModal.getModal();\n    const modal = $modal[0];\n    modal.querySelector('.modal-header').classList.add('hidden');\n    modal.querySelector('.modal-body').classList.add('pt-0');\n    currentModal.setBody(Templates.render('tool_moodlenet/share_modal_content_done', {\n        success: status,\n        sitesupporturl: siteSupportUrl,\n    }));\n};\n\n/**\n * Register events.\n */\nconst registerEventListeners = () => {\n    document.addEventListener('click', e => {\n        const shareAction = e.target.closest(MoodleNetSelectors.action.share);\n        const shareToSuccessAction = e.target.closest('[data-action=\"share-success\"]');\n        const shareToFailAction = e.target.closest('[data-action=\"share-fail\"]');\n        if (shareAction) {\n            e.preventDefault();\n            const type = shareAction.getAttribute('data-type');\n            if (type == 'activity') {\n                const cmId = Config.contextInstanceId;\n                MoodleNetRepository.getActivityInformation(cmId).then((data) => {\n                    if (data.status) {\n                        siteSupportUrl = data.supportpageurl;\n                        const modalPromise = ModalFactory.create({\n                            type: ShareModalActivity.TYPE,\n                            large: true,\n                            templateContext: {\n                                'activitytype': data.type,\n                                'activityname': data.name,\n                                'server': data.server,\n                            }\n                        });\n\n                        return modalPromise.then(modal => {\n                            currentModal = modal;\n                            modal.show();\n                            return modal;\n                        }).catch(displayException);\n                    } else {\n                        return addNotification({\n                            message: data.warnings[0].message,\n                            type: 'error'\n                        });\n                    }\n                }).catch(displayException);\n            }\n        }\n\n        if (shareToSuccessAction) {\n            e.preventDefault();\n            sendToMoodleNet(true);\n        }\n        if (shareToFailAction) {\n            e.preventDefault();\n            sendToMoodleNet(false);\n        }\n    });\n};\n\n/**\n * Initialises.\n */\nexport const init = () => {\n    Prefetch.prefetchTemplates([\n        'tool_moodlenet/share_modal_activity',\n        'tool_moodlenet/share_modal_content_done',\n        'tool_moodlenet/share_modal_content_packaging',\n    ]);\n    registerEventListeners();\n};\n"],"names":["currentModal","siteSupportUrl","sendToMoodleNet","status","getModal","querySelector","classList","remove","setBody","Templates","render","hideFooter","setTimeout","moodleNetDone","modal","add","success","sitesupporturl","prefetchTemplates","document","addEventListener","e","shareAction","target","closest","MoodleNetSelectors","action","share","shareToSuccessAction","shareToFailAction","preventDefault","getAttribute","cmId","Config","contextInstanceId","MoodleNetRepository","getActivityInformation","then","data","supportpageurl","ModalFactory","create","type","ShareModalActivity","TYPE","large","templateContext","name","server","show","catch","displayException","message","warnings"],"mappings":";;;;;;;;SAiCIA,aACAC,6dAMEC,gBAAmBC,SACNH,aAAaI,WACP,GACfC,cAAc,iBAAiBC,UAAUC,OAAO,aAEtDP,aAAaQ,QAAQC,UAAUC,OAAO,+CAAgD,KACtFV,aAAaW,aAEbC,YAAW,KACPC,cAAcV,UACf,MAODU,cAAiBV,eAEbW,MADSd,aAAaI,WACP,GACrBU,MAAMT,cAAc,iBAAiBC,UAAUS,IAAI,UACnDD,MAAMT,cAAc,eAAeC,UAAUS,IAAI,QACjDf,aAAaQ,QAAQC,UAAUC,OAAO,0CAA2C,CAC7EM,QAASb,OACTc,eAAgBhB,iCA2DJ,uBACPiB,kBAAkB,CACvB,sCACA,0CACA,iDAvDJC,SAASC,iBAAiB,SAASC,UACzBC,YAAcD,EAAEE,OAAOC,QAAQC,mBAAmBC,OAAOC,OACzDC,qBAAuBP,EAAEE,OAAOC,QAAQ,iCACxCK,kBAAoBR,EAAEE,OAAOC,QAAQ,iCACvCF,cACAD,EAAES,iBAEU,YADCR,YAAYS,aAAa,cACd,OACdC,KAAOC,gBAAOC,kBACpBC,oBAAoBC,uBAAuBJ,MAAMK,MAAMC,MAC/CA,KAAKnC,QACLF,eAAiBqC,KAAKC,eACDC,uBAAaC,OAAO,CACrCC,KAAMC,8BAAmBC,KACzBC,OAAO,EACPC,gBAAiB,cACGR,KAAKI,kBACLJ,KAAKS,YACXT,KAAKU,UAIHX,MAAKvB,QACrBd,aAAec,MACfA,MAAMmC,OACCnC,SACRoC,MAAMC,kCAEF,iCAAgB,CACnBC,QAASd,KAAKe,SAAS,GAAGD,QAC1BV,KAAM,YAGfQ,MAAMC,gCAIbvB,uBACAP,EAAES,iBACF5B,iBAAgB,IAEhB2B,oBACAR,EAAES,iBACF5B,iBAAgB"}