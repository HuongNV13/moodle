define ("block_timeline/view_courses",["jquery","core/notification","core/custom_interaction_events","core/templates","block_timeline/event_list","core_course/repository","block_timeline/calendar_events_repository"],function(a,b,c,d,e,f,g){var h={MORE_COURSES_BUTTON:"[data-action=\"more-courses\"]",MORE_COURSES_BUTTON_CONTAINER:"[data-region=\"more-courses-button-container\"]",NO_COURSES_EMPTY_MESSAGE:"[data-region=\"no-courses-empty-message\"]",NO_COURSES_WITH_EVENTS_MESSAGE:"[data-region=\"empty-message\"]",COURSES_LIST:"[data-region=\"courses-list\"]",COURSE_ITEMS_LOADING_PLACEHOLDER:"[data-region=\"course-items-loading-placeholder\"]",COURSE_EVENTS_CONTAINER:"[data-region=\"course-events-container\"]",COURSE_NAME:"[data-region=\"course-name\"]",LOADING_ICON:".loading-icon",TIMELINE_BLOCK:"[data-region=\"timeline\"]",TIMELINE_SEARCH:"[data-action=\"search\"]"},i={COURSE_ITEMS:"block_timeline/course-items",LOADING_ICON:"core/loading"},j=86400,k={courseview:!0},l=function(a){a.find(h.COURSE_ITEMS_LOADING_PLACEHOLDER).addClass("hidden")},m=function(a){a.find(h.COURSE_ITEMS_LOADING_PLACEHOLDER).removeClass("hidden")},n=function(a){a.find(h.MORE_COURSES_BUTTON_CONTAINER).addClass("hidden")},o=function(a){a.find(h.MORE_COURSES_BUTTON_CONTAINER).removeClass("hidden")},p=function(a){var b=a.find(h.MORE_COURSES_BUTTON);b.prop("disabled",!0);d.render(i.LOADING_ICON,{}).then(function(a){b.append(a);return a}).catch(function(){return!1})},q=function(a){var b=a.find(h.MORE_COURSES_BUTTON);b.prop("disabled",!1);b.find(h.LOADING_ICON).remove()},r=function(a){var b=a.find(h.COURSES_LIST);d.replaceNodeContents(b,"","");a.find(h.NO_COURSES_WITH_EVENTS_MESSAGE).removeClass("hidden")},s=function(a){a.find(h.NO_COURSES_WITH_EVENTS_MESSAGE).addClass("hidden")},t=function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!1,e=a.find(h.COURSES_LIST);if(c){d.appendNodeContents(e,b,"")}else{d.replaceNodeContents(e,b,"")}},u=function(a){return parseInt(a.attr("data-offset"),10)},v=function(a,b){a.attr("data-offset",b)},w=function(a){return parseInt(a.attr("data-limit"),10)},x=function(a){return parseInt(a.attr("data-days-offset"),10)},y=function(a){var b=a.attr("data-days-limit");return b!=void 0?parseInt(b,10):void 0},z=function(a){return parseInt(a.attr("data-midnight"),10)},A=function(a){var b=z(a),c=x(a);return b+c*j},B=function(a){var b=z(a),c=y(a);return c!=void 0?b+c*j:null},C=function(a,b,c,d,e){var f={courseids:a,starttime:b,limit:c};if(d){f.endtime=d}if(e){f.searchvalue=e}return g.queryByCourses(f)},D=function(a){return a.data("last-event-load-time")},E=function(a,b){a.data("last-event-load-time",b)},F=function(a,b){return D(a)>b},G=function(a,b,c,d){var e=a.map(function(a){return a.id});return C(e,b,5+1,c,d)},H=function(a,b,c,e,f,g){return d.render(i.COURSE_ITEMS,{courses:a,midnight:c,hasdaysoffset:!0,hasdayslimit:f!=void 0,daysoffset:e,dayslimit:f,nodayslimit:f==void 0,courseview:!0,hascourses:!0}).then(function(a){l(b);if(a){t(b,a,g)}return a}).then(function(c){if(a.length<2){n(b)}else{o(b)}return c}).catch(function(){l(b)})},I=function(c){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,g=u(c),i=w(c),j=A(c),l=B(c),m=c.closest(h.TIMELINE_BLOCK).find(h.TIMELINE_SEARCH).val();return f.getEnrolledCoursesWithEventsByTimelineClassification("inprogress",i,g,"fullname asc",m,j,l).then(function(b,f,h){var i=Date.now(),j=b.courses,l=b.nextoffset,p=x(c),q=y(c),s=z(c),t=b.morecoursesavailable;v(c,l);var u=G(j,f,h,m),w=H(j,c,s,p,q,d);return a.when(u,w).then(function(a){if(F(c,i)){return a}if(0<j.length){j.forEach(function(a){var b=a.id,d=c.find("[data-region=\"course-events-container\"][data-course-id=\""+b+"\"]"),f=d.find(e.rootSelector);e.init(f,k)});if(!t){n(c)}else{o(c)}}else{n(c);if(0==g){r(c)}}return a})}).catch(b.exception)},J=function(a){c.define(a,[c.events.activate]);a.on(c.events.activate,h.MORE_COURSES_BUTTON,function(b,c){p(a);I(a,!0).then(function(){q(a)}).catch(function(){q(a)});if(c){c.originalEvent.preventDefault();c.originalEvent.stopPropagation()}b.stopPropagation()})},K=function(a){if(!a.attr("data-seen")&&!a.find(h.NO_COURSES_EMPTY_MESSAGE).length){I(a);a.attr("data-seen",!0)}};return{init:function init(b){b=a(b);if(!b.find(h.NO_COURSES_EMPTY_MESSAGE).length){E(b,Date.now());if(b.hasClass("active")){I(b);b.attr("data-seen",!0)}J(b)}},reset:function reset(a){v(a,0);m(a);s(a);a.removeAttr("data-seen");if(a.hasClass("active")){K(a)}},shown:K}});
//# sourceMappingURL=view_courses.min.js.map
