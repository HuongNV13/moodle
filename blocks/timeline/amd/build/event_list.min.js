define ("block_timeline/event_list",["jquery","core/notification","core/templates","core/paged_content_factory","core/str","core/user_date","block_timeline/calendar_events_repository"],function(a,b,c,d,e,f,g){var h={EMPTY_MESSAGE:"[data-region=\"empty-message\"]",ROOT:"[data-region=\"event-list-container\"]",EVENT_LIST_CONTENT:"[data-region=\"event-list-content\"]",EVENT_LIST_LOADING_PLACEHOLDER:"[data-region=\"event-list-loading-placeholder\"]",MORE_EVENTS_BUTTON:"[data-action=\"more-events\"]"},i={EVENT_LIST_CONTENT:"block_timeline/event-list-content"},j={ignoreControlWhileLoading:!0,controlPlacementBottom:!0,ariaLabels:{itemsperpagecomponents:"ariaeventlistpagelimit, block_timeline"}},k,l=function(a){a.find(h.EVENT_LIST_CONTENT).removeClass("hidden");a.find(h.EMPTY_MESSAGE).addClass("hidden")},m=function(a){a.find(h.EVENT_LIST_CONTENT).empty()},n=function(a,b){var c={},d={eventsbyday:[]};a.forEach(function(a){var b=a.timeusermidnight;if(c[b]){c[b].push(a)}else{c[b]=[a]}});Object.keys(c).forEach(function(a){var e=c[a];d.eventsbyday.push({past:a<b,dayTimestamp:a,events:e})});return d},o=function(a,b){var d=n(a,b),e=i.EVENT_LIST_CONTENT;return c.render(e,d)},p=function(a,b,c,d,e,f){var h=d!=void 0?a+d*86400:!1,i={starttime:a+c*86400,limit:b};if(e){i.aftereventid=e}if(h){i.endtime=h}if(f){i.courseid=f;return g.queryByCourse(i)}else{return g.queryByTime(i)}},q=function(a,b,c,d,e,g){var h=p(a,5,d,e,b,c);return h.then(function(b){if(!b.events.length){return[]}var c=b.events.filter(function(b){if("open"==b.eventtype||"opensubmission"==b.eventtype){var c=f.getUserMidnightForTimestamp(b.timesort,a);return c>a}return!0}),d=c.at(-1).id;t(g,d);if(c.length<5){g.hide()}return c})},r=function(c,d,f,g,h,i,k,l,m,n){var p=a.extend({},j,m);return e.get_string("ariaeventlistpagelimit","block_timeline",a.isArray(c)?c[0].value:c).then(function(a){p.ariaLabels.itemsperpage=a;p.ariaLabels.paginationnav=l;return a}).then(function(){var a=q(f,0,h,i,k,n).then(function(a){if(a.length){return o(a,f)}else{return a}}).catch(b.exception);return a})},s=function(a){return parseInt(a.attr("data-offset"),10)},t=function(a,b){a.attr("data-offset",b)},u=function(){var a=k.parent().find(h.MORE_EVENTS_BUTTON);a.on("click",v)},v=function(){var d=a(this),e=d.parent().find(h.ROOT),f=parseInt(e.attr("data-midnight"),10),g=e.attr("data-course-id"),i=parseInt(e.attr("data-days-offset"),10),j=e.attr("data-days-limit"),k=s(d),l=e.find(h.EVENT_LIST_CONTENT).find("div").first(),m=q(f,k,g,i,j,d);m.then(function(b){if(b.length){var d=o(b,f);d.then(function(b,d){b=a(b);var e=b.find("div").first();c.appendNodeContents(l,e,d)})}}).catch(b.exception)};return{init:function init(d,e,f,g,i){d=a(d);k=d;u();var j=a.Deferred(),n=d.find(h.EVENT_LIST_CONTENT),o=d.find(h.EVENT_LIST_LOADING_PLACEHOLDER),p=d.attr("data-course-id"),q=parseInt(d.attr("data-days-offset"),10),s=d.attr("data-days-limit"),t=parseInt(d.attr("data-midnight"),10),v=d.parent().find(h.MORE_EVENTS_BUTTON);m(d);l(d);o.removeClass("hidden");if(s!=void 0){s=parseInt(s,10)}return r(e,f,t,j,p,q,s,g,i,v).then(function(b,d){b=a(b);b.addClass("hidden");c.replaceNodeContents(n,b,d);b.removeClass("hidden");o.addClass("hidden");return b}).catch(b.exception)},rootSelector:h.ROOT}});
//# sourceMappingURL=event_list.min.js.map
